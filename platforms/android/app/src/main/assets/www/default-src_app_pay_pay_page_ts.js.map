{"version":3,"sources":["./src/app/confirm-pay/confirm-pay.component.ts","./src/app/pay.service.ts","./src/app/pay/pay.page.ts","./src/app/confirm-pay/confirm-pay.component.scss","./src/app/pay/pay.page.scss","./src/app/confirm-pay/confirm-pay.component.html","./src/app/pay/pay.page.html"],"names":[],"mappings":"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","file":"default-src_app_pay_pay_page_ts.js","sourcesContent":["import {\r\n  AfterViewInit,\r\n  Component,\r\n  ElementRef,\r\n  OnInit,\r\n  ViewChild,\r\n} from '@angular/core';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport { ModalController } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-confirm-pay',\r\n  templateUrl: './confirm-pay.component.html',\r\n  styleUrls: ['./confirm-pay.component.scss'],\r\n})\r\nexport class ConfirmPayComponent implements OnInit, AfterViewInit {\r\n  @ViewChild('iframe') iframe: ElementRef;\r\n\r\n  page: any;\r\n  constructor(\r\n    private sanitizer: DomSanitizer,\r\n    private modalController: ModalController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.transformHtml(this.page);\r\n  }\r\n\r\n  transformHtml(htmlTextWithStyle) {\r\n    this.sanitizer.bypassSecurityTrustHtml(htmlTextWithStyle);\r\n    this.sanitizer.bypassSecurityTrustScript(htmlTextWithStyle);\r\n  }\r\n\r\n  ngAfterViewInit() {\r\n    const doc =\r\n      this.iframe.nativeElement.contentDocument ||\r\n      this.iframe.nativeElement.contentWindow;\r\n    doc.open();\r\n    doc.write(this.page);\r\n    doc.close();\r\n  }\r\n\r\n  close() {\r\n    this.modalController.dismiss();\r\n  }\r\n}\r\n","/* eslint-disable @typescript-eslint/naming-convention */\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, Subject } from 'rxjs';\r\n\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class PaymentService {\r\n  reciept: BehaviorSubject<any> = new BehaviorSubject({});\r\n  refId: BehaviorSubject<string> = new BehaviorSubject('');\r\n  url = 'https://ketengah-api.prototype.com.my/fpx/initiate/payment/app/test';\r\n  constructor(private http: HttpClient) { }\r\n\r\n  submitPayment(paymentDetails: PaymentDetails) {\r\n    console.log(paymentDetails, 'success');\r\n    this.refId.next(paymentDetails.referenceId)\r\n\r\n\r\n    return this.http.get(\r\n      this.url,\r\n      {\r\n        params: {\r\n          reference_id: paymentDetails.referenceId,\r\n          customer_email: paymentDetails.customerEmail,\r\n          amount: paymentDetails.amount,\r\n          additional_params: paymentDetails.additionalInfo,\r\n          remark: paymentDetails.remark,\r\n          customer_name: paymentDetails.customerName,\r\n        },\r\n\r\n      }\r\n\r\n    );\r\n  }\r\n}\r\n\r\nexport interface PaymentDetails {\r\n  referenceId: string;\r\n  customerName: string;\r\n  customerEmail: string;\r\n  remark: string;\r\n  additionalInfo: string;\r\n  amount: number;\r\n}\r\n","/* eslint-disable max-len */\r\nimport { Component, NgZone, OnInit } from '@angular/core';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { LoadingController, ModalController } from '@ionic/angular';\r\nimport { ConfirmPayComponent } from '../confirm-pay/confirm-pay.component';\r\nimport { PaymentService } from '../pay.service';\r\nimport { InAppBrowser } from '@ionic-native/in-app-browser/ngx';\r\nimport { NavigationExtras, Router } from '@angular/router';\r\nimport { NativeStorage } from '@awesome-cordova-plugins/native-storage/ngx';\r\n@Component({\r\n  selector: 'app-pay',\r\n  templateUrl: './pay.page.html',\r\n  styleUrls: ['./pay.page.scss'],\r\n})\r\nexport class PayPage implements OnInit {\r\n  paymentForm: FormGroup;\r\n  responsePage: any;\r\n  paymentRequested = false;\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private paymentService: PaymentService,\r\n    private modalController: ModalController,\r\n    private iab: InAppBrowser,\r\n    private router: Router,\r\n    private nativeStorage: NativeStorage,\r\n    private ngZone: NgZone\r\n  ) { }\r\n\r\n  ngOnInit() {\r\n    this.paymentForm = this.formBuilder.group({\r\n      referenceId: ['',],\r\n      customerName: ['', Validators.required],\r\n      amount: ['', Validators.required],\r\n      remark: ['', Validators.required],\r\n      customerEmail: ['', Validators.required],\r\n      additionalInfo: [''],\r\n    });\r\n\r\n    // this.paymentForm.patchValue({\r\n    //   referenceId: '123',\r\n    //   customerName: 'John Doe',\r\n    //   amount: 100,\r\n    //   remark: 'Test',\r\n    //   customerEmail: 'ak@gmail.com',\r\n    //   additionalInfo: 'Test',\r\n    // });\r\n  }\r\n\r\n  async pay() {\r\n    const data = this.paymentForm.value;\r\n\r\n    let ref;\r\n    let browser;\r\n    let navigationExtras: NavigationExtras;\r\n\r\n    // eslint-disable-next-line max-len\r\n    this.nativeStorage.getItem('user').then((u) => {\r\n\r\n      ref = u.value.user_id + Date.now().toString();\r\n      this.paymentService.refId.next(ref);\r\n      console.log('referenceeeeee', ref);\r\n      console.log('subjecttt', this.paymentService.refId.value);\r\n      console.log(\"referenceee\")\r\n      console.log(u.value)\r\n      const url = `https://ketengah-api.prototype.com.my/fpx/initiate/payment/app/?reference_id=${ref}&customer_email=${data.customerEmail}&amount=${data.amount}&remark=${data.remark}&additional_params=${data.additionalInfo}&customer_name=${data.customerName}`;\r\n\r\n      browser = this.iab.create(url, '_blank');\r\n      browser.on('loadstop').subscribe((event) => {\r\n        console.log(event)\r\n        if (event.url.endsWith('callback')) {\r\n          // browser.executeScript({ code: 'document.getElementsByTagName(\"html\")[0].innerHTML' }).then(html => { console.log(html); browser.close(); });\r\n          browser.close();\r\n          this.modalController.dismiss()\r\n          this.router.navigate(['main/tabs/bayaran/resit'], navigationExtras);\r\n\r\n\r\n        }\r\n      });\r\n    })\r\n\r\n\r\n\r\n\r\n  }\r\n\r\n  async presentModal() {\r\n    const modal = await this.modalController.create({\r\n      component: ConfirmPayComponent,\r\n      componentProps: { value: 123, page: this.responsePage },\r\n    });\r\n\r\n    await modal.present();\r\n  }\r\n\r\n  close() {\r\n    this.modalController.dismiss()\r\n  }\r\n\r\n\r\n\r\n}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJjb25maXJtLXBheS5jb21wb25lbnQuc2NzcyJ9 */\";","export default \"form {\\n  margin-top: 0.5rem;\\n}\\n\\n.boxwhite {\\n  color: #3D2C7C;\\n  padding: 25px 0px 0px 0px;\\n  font-size: 16px;\\n  width: 80%;\\n  margin: auto;\\n}\\n\\n.input {\\n  color: black;\\n  display: inline-block;\\n  width: 100%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBheS5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7RUFDRSxrQkFBQTtBQURGOztBQUlBO0VBQ0UsY0FBQTtFQUNBLHlCQUFBO0VBQ0EsZUFBQTtFQUNBLFVBQUE7RUFDQSxZQUFBO0FBREY7O0FBSUE7RUFDRSxZQUFBO0VBQ0EscUJBQUE7RUFDQSxXQUFBO0FBREYiLCJmaWxlIjoicGF5LnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuZm9ybSB7XHJcbiAgbWFyZ2luLXRvcDogMC41cmVtO1xyXG59XHJcblxyXG4uYm94d2hpdGUge1xyXG4gIGNvbG9yOiAjM0QyQzdDO1xyXG4gIHBhZGRpbmc6IDI1cHggMHB4IDBweCAwcHg7XHJcbiAgZm9udC1zaXplOiAxNnB4O1xyXG4gIHdpZHRoOiA4MCU7XHJcbiAgbWFyZ2luOmF1dG87XHJcbn1cclxuXHJcbi5pbnB1dCB7XHJcbiAgY29sb3I6IGJsYWNrO1xyXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcclxuICB3aWR0aDogMTAwJTtcclxufVxyXG4iXX0= */\";","export default \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-buttons slot=\\\"secondary\\\">\\r\\n      <ion-button (click)=\\\"close()\\\">\\r\\n        <ion-icon slot=\\\"start\\\" name=\\\"close\\\"></ion-icon>\\r\\n        close\\r\\n      </ion-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>Confirm payment</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n  <iframe #iframe height=\\\"100%\\\" width=\\\"100%\\\" frameborder=\\\"0\\\"></iframe>\\r\\n</ion-content>\\r\\n\";","export default \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-button (click)=\\\"close()\\\">\\r\\n        <ion-icon slot=\\\"start\\\" name=\\\"close\\\"></ion-icon>\\r\\n        Close\\r\\n      </ion-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>pay</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n  <form [formGroup]=\\\"paymentForm\\\" (ngSubmit)=\\\"pay()\\\">\\r\\n    <!-- create ionic form with referene number, customer name,  email, amount  ,remark , additional params  -->\\r\\n\\r\\n\\r\\n    <div class=\\\"boxwhite\\\" style=\\\"border-bottom: 0.7px solid #E8E8E8\\\">\\r\\n      Customer Name<br>\\r\\n      <ion-input formControlName=\\\"customerName\\\" type=\\\"text\\\" class=\\\"input\\\"></ion-input>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"boxwhite\\\" style=\\\"border-bottom: 0.7px solid #E8E8E8\\\">\\r\\n      Customer Email<br>\\r\\n      <ion-input formControlName=\\\"customerEmail\\\" type=\\\"text\\\" class=\\\"input\\\"></ion-input>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"boxwhite\\\" style=\\\"border-bottom: 0.7px solid #E8E8E8\\\">\\r\\n      Amount<br>\\r\\n      <ion-input formControlName=\\\"amount\\\" type=\\\"text\\\" class=\\\"input\\\"></ion-input>\\r\\n    </div>\\r\\n\\r\\n    <div class=\\\"boxwhite\\\" style=\\\"border-bottom: 0.7px solid #E8E8E8\\\">\\r\\n      Remark<br>\\r\\n      <ion-input formControlName=\\\"remark\\\" type=\\\"text\\\" class=\\\"input\\\"></ion-input>\\r\\n    </div>\\r\\n\\r\\n\\r\\n\\r\\n    <ion-button expand=\\\"block\\\" type=\\\"submit\\\" [disabled]=\\\"!paymentForm.valid\\\">Pay</ion-button>\\r\\n  </form>\\r\\n</ion-content>\\r\\n\";"],"sourceRoot":"webpack:///"}